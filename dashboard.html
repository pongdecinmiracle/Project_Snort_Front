<!DOCTYPE html>
<html lang="en">
	<head>
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
		<meta charset="utf-8" />
		<title>Dashboard</title>

		<meta name="description" content="overview &amp; stats" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0" />

		<!-- bootstrap & fontawesome -->
		<link rel="stylesheet" href="assets/css/bootstrap.min.css" />
		<link rel="stylesheet" href="assets/font-awesome/4.5.0/css/font-awesome.min.css" />

		<!-- page specific plugin styles -->
 
		<!-- text fonts -->
		<link rel="stylesheet" href="assets/css/fonts.googleapis.com.css" />

		<!-- ace styles -->
		<link rel="stylesheet" href="assets/css/ace.min.css" class="ace-main-stylesheet" id="main-ace-style" />

		<!--[if lte IE 9]>
			<link rel="stylesheet" href="assets/css/ace-part2.min.css" class="ace-main-stylesheet" />
		<![endif]-->
		<link rel="stylesheet" href="assets/css/ace-skins.min.css" />
		<link rel="stylesheet" href="assets/css/ace-rtl.min.css" />

		<!--[if lte IE 9]>
		  <link rel="stylesheet" href="assets/css/ace-ie.min.css" />
		<![endif]-->

		<!-- inline styles related to this page -->

		<!-- ace settings handler -->
		<script src="assets/js/ace-extra.min.js"></script>

		<!-- HTML5shiv and Respond.js for IE8 to support HTML5 elements and media queries -->

		<!--[if lte IE 8]>
		<script src="assets/js/html5shiv.min.js"></script>
		<script src="assets/js/respond.min.js"></script>
		<![endif]-->
		<style>
				li.isHidden{
					display : none
				}
				li.isHidden2{
					display : none
				}
			</style>
	</head>

	<body class="no-skin">
		<div id="navbar" class="navbar navbar-default          ace-save-state">
			<div class="navbar-container ace-save-state" id="navbar-container">
				<button type="button" class="navbar-toggle menu-toggler pull-left" id="menu-toggler" data-target="#sidebar">
					<span class="sr-only">Toggle sidebar</span>

					<span class="icon-bar"></span>

					<span class="icon-bar"></span>

					<span class="icon-bar"></span>
				</button>

				<div class="navbar-header pull-left">
					<a href="dashboard.html" class="navbar-brand">
						<small>
							<i class="fa fa-leaf"></i>
							Distributed IPS
						</small>
					</a>
				</div>

				<div class="navbar-buttons navbar-header pull-right" role="navigation">
					<ul class="nav ace-nav">

						<li class="purple dropdown-modal">
							<a data-toggle="dropdown" class="dropdown-toggle" href="#">
								<i class="ace-icon fa fa-bell icon-animated-bell"></i>
								<span class="badge badge-important">10</span>
							</a>

							<ul class="dropdown-menu-right dropdown-navbar navbar-pink dropdown-menu dropdown-caret dropdown-close">
								<li class="dropdown-header">
									<i class="ace-icon fa fa-exclamation-triangle"></i>
									10 Notifications
								</li>

								<li class="dropdown-content">
									<ul class="dropdown-menu dropdown-navbar navbar-pink">
										<li>
											<a href="">
												<div class="clearfix">
													<span class="pull-left">
														<i class="btn btn-xs no-hover btn-pink fa fa-exclamation-triangle"></i>
														All New Detect !!
													</span>
													<span class="pull-right badge badge-info">+12</span>
												</div>
											</a>
										</li>
										
										<li>
											<a href="tables.html">
													<i class="fa bigger-110 fa-user">
															New Update By Raspberry Pi 1
													</i>
												<span class="pull-right badge badge-info">+11</span>
											</a>
										</li>
										
										<li>
											<a href="tables_pi2.html">
													<i class="fa bigger-110 fa-user">
															New Update By Raspberry Pi 2
													</i>
												<span class="pull-right badge badge-info">+12</span>
											</a>
										</li>
										
										<li>
											<a href="tables_pi3.html">
													<i class="fa bigger-110 fa-user">
															New Update By Raspberry Pi 3
													</i>
												<span class="pull-right badge badge-info">+8</span>
											</a>
										</li>



									</ul>
								</li>

								
							</ul>
						</li>

						

						<li class="light-blue dropdown-modal">
							<a data-toggle="dropdown" href="#" class="dropdown-toggle">
								<img class="nav-user-photo" src="assets/images/avatars/avatar2.png" alt="User's Photo" />
								<span class="user-info">
									<small>Welcome,</small>
<!-- User -->							<div id="user"></div>
									
								</span>

								<i class="ace-icon fa fa-caret-down"></i>
							</a>

							<ul class="user-menu dropdown-menu-right dropdown-menu dropdown-yellow dropdown-caret dropdown-close">
								

								<li>
									<a href="profile.html">
										<i class="ace-icon fa fa-user"></i>
										Profile
									</a>
								</li>

								<li class="divider"></li>

								<li>
									<a onclick="logout()">
										<i class="ace-icon fa fa-power-off" ></i>
										Logout
									</a>
								</li>
							</ul>
						</li>
					</ul>
				</div>
			</div><!-- /.navbar-container -->
		</div>

		
		
		<div class="main-container ace-save-state" id="main-container">
			<script type="text/javascript">
				try{ace.settings.loadState('main-container')}catch(e){}
			</script>

			<div id="sidebar" class="sidebar                  responsive                    ace-save-state">
				<script type="text/javascript">
					try{ace.settings.loadState('sidebar')}catch(e){}
				</script>

				<div class="sidebar-shortcuts" id="sidebar-shortcuts">


					<div class="sidebar-shortcuts-mini" id="sidebar-shortcuts-mini">
						<span class="btn btn-success"></span>

						<span class="btn btn-info"></span>

						<span class="btn btn-warning"></span>

						<span class="btn btn-danger"></span>
					</div>
				</div><!-- /.sidebar-shortcuts -->

				<ul class="nav nav-list">
						<li class="active">
							<a href="dashboard.html">
								<i class="menu-icon fa fa-tachometer"></i>
								<span class="menu-text"> Dashboard </span>
							</a>
	
							<b class="arrow"></b>
						</li>
						<!--  -->
						<li class="isHidden">
								<a href="#" class="dropdown-toggle">
									<i class="menu-icon glyphicon glyphicon-user"></i>
									<span class="menu-text"> Admin Modify </span>
		
									<b class="arrow fa fa-angle-down"></b>
								</a>
		
								<b class="arrow"></b>
		
								<ul class="submenu">
										<li class="">
												<a href="add_rule1.php">
													<i class="menu-icon glyphicon glyphicon-user"></i>
													Add Rule : Raspberry Pi1
												</a>
						
												<b class="arrow"></b>
										</li>
						
										<li class="">
												<a href="add_rule2.php">
													<i class="menu-icon glyphicon glyphicon-user"></i>
													Add Rule : Raspberry Pi2
												</a>
						
												<b class="arrow"></b>
										</li>
	
										<li class="">
												<a href="add_rule3.php">
													<i class="menu-icon glyphicon glyphicon-user"></i>
													Add Rule : Raspberry Pi3
												</a>
						
												<b class="arrow"></b>
										</li>
	
										<li class="">
													<a href="verify.html">
														<i class="menu-icon glyphicon glyphicon-user"></i>
														Verify By Admin
													</a>
							
													<b class="arrow"></b>
										</li>
									
								</ul>
							</li>
						<!--  -->
	
	
						<li class="">
							<a href="#" class="dropdown-toggle">
								<i class="menu-icon fa fa-list"></i>
								<span class="menu-text"> Tables </span>
	
								<b class="arrow fa fa-angle-down"></b>
							</a>
	
							<b class="arrow"></b>
	
							<ul class="submenu">
								<li class="">
									<a href="tables.html">
										<i class="menu-icon fa fa-caret-right"></i>
										Raspberry Pi 1
									</a>
	
									<b class="arrow"></b>
								</li>
	
								<li class="">
									<a href="tables_pi2.html">
										<i class="menu-icon fa fa-caret-right"></i>
										Raspberry Pi 2
									</a>
	
									<b class="arrow"></b>
								</li>
								
								<li class="">
									<a href="tables_pi3.html">
										<i class="menu-icon fa fa-caret-right"></i>
										Raspberry Pi 3
									</a>
	
									<b class="arrow"></b>
								</li>
								
							</ul>
						</li>
	
					</ul><!-- /.nav-list -->
				

				<div class="sidebar-toggle sidebar-collapse" id="sidebar-collapse">
					<i id="sidebar-toggle-icon" class="ace-icon fa fa-angle-double-left ace-save-state" data-icon1="ace-icon fa fa-angle-double-left" data-icon2="ace-icon fa fa-angle-double-right"></i>
				</div>
			</div>
			
			

			<div class="main-content">
				<div class="main-content-inner">
					<div class="breadcrumbs ace-save-state" id="breadcrumbs">
						<ul class="breadcrumb">
							<li>
								<i class="ace-icon fa fa-home home-icon"></i>
								<a href="dashboard.html">Home</a>
							</li>
							<li class="active">Dashboard</li>
						</ul><!-- /.breadcrumb -->

						<div class="nav-search" id="nav-search">
							<form class="form-search">
								<span class="input-icon">
									<input type="text" placeholder="Search ..." class="nav-search-input" id="nav-search-input" autocomplete="off" />
									<i class="ace-icon fa fa-search nav-search-icon"></i>
								</span>
							</form>
						</div><!-- /.nav-search -->
					</div>

					<div class="page-content">
					
						<div class="page-header">
							<h1>
								Dashboard
								<small>
									<i class="ace-icon fa fa-angle-double-right"></i>
									overview &amp; stats
								</small>
							</h1>
						</div><!-- /.page-header -->

						<div class="row">
							<div class="col-xs-12">
								<!-- PAGE CONTENT BEGINS -->
								<div class="alert alert-block alert-success">
									<button type="button" class="close" data-dismiss="alert">
										<i class="ace-icon fa fa-times"></i>
									</button>

									<i class="ace-icon fa fa-check green"></i>

									Welcome to
									<strong class="green">
										Distibuted IPS Control
									</strong>Dashboard
								</div>

								<!-- Dashboard 1 -->
								
								<div class="row">

									<div class="col-sm-4">
										<div class="widget-box">
											<div class="widget-header widget-header-flat widget-header-small">
												<h5 class="widget-title">
													<i class="ace-icon fa fa-signal"></i>
													Traffic Raspberry Pi 1
												</h5>

												<div class="widget-toolbar no-border">
													<div class="inline dropdown-hover">
														<button class="btn btn-minier btn-primary">
															This Week
															<i class="ace-icon fa fa-angle-down icon-on-right bigger-110"></i>
														</button>

														<ul class="dropdown-menu dropdown-menu-right dropdown-125 dropdown-lighter dropdown-close dropdown-caret">
															<li class="active">
																<a href="#" class="blue">
																	<i class="ace-icon fa fa-caret-right bigger-110">&nbsp;</i>
																	This Week
																</a>
															</li>

															<li>
																<a href="#">
																	<i class="ace-icon fa fa-caret-right bigger-110 invisible">&nbsp;</i>
																	Last Week
																</a>
															</li>

															<li>
																<a href="#">
																	<i class="ace-icon fa fa-caret-right bigger-110 invisible">&nbsp;</i>
																	This Month
																</a>
															</li>

															<li>
																<a href="#">
																	<i class="ace-icon fa fa-caret-right bigger-110 invisible">&nbsp;</i>
																	Last Month
																</a>
															</li>
														</ul>
													</div>
												</div>
											</div>

											<div class="widget-body">
												<div class="widget-main">
													<div id="piechart-placeholder"></div>

													<div class="hr hr8 hr-double"></div>
												</div><!-- /.widget-main -->
											</div><!-- /.widget-body -->
											
										</div><!-- /.widget-box -->
									</div><!-- /.col -->
									
									
									
									<!-- Dashboard 2 -->
									
									<div class="col-sm-4">
										<div class="widget-box">
											<div class="widget-header widget-header-flat widget-header-small">
												<h5 class="widget-title">
													<i class="ace-icon fa fa-signal"></i>
													Traffic Raspberry Pi 2
												</h5>

												<div class="widget-toolbar no-border">
													<div class="inline dropdown-hover">
														<button class="btn btn-minier btn-primary">
															This Week
															<i class="ace-icon fa fa-angle-down icon-on-right bigger-110"></i>
														</button>

														<ul class="dropdown-menu dropdown-menu-right dropdown-125 dropdown-lighter dropdown-close dropdown-caret">
															<li class="active">
																<a href="#" class="blue">
																	<i class="ace-icon fa fa-caret-right bigger-110">&nbsp;</i>
																	This Week
																</a>
															</li>

															<li>
																<a href="#">
																	<i class="ace-icon fa fa-caret-right bigger-110 invisible">&nbsp;</i>
																	Last Week
																</a>
															</li>

															<li>
																<a href="#">
																	<i class="ace-icon fa fa-caret-right bigger-110 invisible">&nbsp;</i>
																	This Month
																</a>
															</li>

															<li>
																<a href="#">
																	<i class="ace-icon fa fa-caret-right bigger-110 invisible">&nbsp;</i>
																	Last Month
																</a>
															</li>
														</ul>
													</div>
												</div>
											</div>

											<div class="widget-body">
												<div class="widget-main">
													<div id="piechart-placeholder2"></div>

													<div class="hr hr8 hr-double"></div>
												</div><!-- /.widget-main -->
											</div><!-- /.widget-body -->
										</div><!-- /.widget-box -->
									</div><!-- /.col -->
									
									
									<!-- Dashboard 3 -->

									<div class="col-sm-4">
										<div class="widget-box">
											<div class="widget-header widget-header-flat widget-header-small">
												<h5 class="widget-title">
													<i class="ace-icon fa fa-signal"></i>
													Traffic Raspberry Pi 2
												</h5>

												<div class="widget-toolbar no-border">
													<div class="inline dropdown-hover">
														<button class="btn btn-minier btn-primary">
															This Week
															<i class="ace-icon fa fa-angle-down icon-on-right bigger-110"></i>
														</button>

														<ul class="dropdown-menu dropdown-menu-right dropdown-125 dropdown-lighter dropdown-close dropdown-caret">
															<li class="active">
																<a href="#" class="blue">
																	<i class="ace-icon fa fa-caret-right bigger-110">&nbsp;</i>
																	This Week
																</a>
															</li>

															<li>
																<a href="#">
																	<i class="ace-icon fa fa-caret-right bigger-110 invisible">&nbsp;</i>
																	Last Week
																</a>
															</li>

															<li>
																<a href="#">
																	<i class="ace-icon fa fa-caret-right bigger-110 invisible">&nbsp;</i>
																	This Month
																</a>
															</li>

															<li>
																<a href="#">
																	<i class="ace-icon fa fa-caret-right bigger-110 invisible">&nbsp;</i>
																	Last Month
																</a>
															</li>
														</ul>
													</div>
												</div>
											</div>

											<div class="widget-body">
												<div class="widget-main">
													<div id="piechart-placeholder3"></div>

													<div class="hr hr8 hr-double"></div>
												</div><!-- /.widget-main -->
											</div><!-- /.widget-body -->
										</div><!-- /.widget-box -->
									</div><!-- /.col -->
									
									
								</div><!-- /.row -->
								
								
							
								<div class="row">

									<div class="col-sm-12">
										<div class="widget-box transparent">
											<div class="widget-header widget-header-flat">
												<h4 class="widget-title lighter">
													<i class="ace-icon fa fa-signal"></i>
													Stats
												</h4>

												<div class="widget-toolbar">
													<a href="#" data-action="collapse">
														<i class="ace-icon fa fa-chevron-up"></i>
													</a>
												</div>
											</div>

											<div class="widget-body">
												<div class="widget-main padding-4">
													<div id="chart_div"></div>
												</div><!-- /.widget-main -->
											</div><!-- /.widget-body -->
										</div><!-- /.widget-box -->
									</div><!-- /.col -->
								</div><!-- /.row -->


								<!-- PAGE CONTENT ENDS -->
							</div><!-- /.col -->
						</div><!-- /.row -->
					</div><!-- /.page-content -->
				</div>
			</div><!-- /.main-content -->

			<div class="footer">
				<div class="footer-inner">
					<div class="footer-content">
						<span class="bigger-120">
							<span class="blue bolder">Distibuted IPS</span>
							Application &copy; 2017
						</span>

						<!----------------------------------------------------------------------
						&nbsp; &nbsp;
						<span class="action-buttons">
							<a href="#">
								<i class="ace-icon fa fa-twitter-square light-blue bigger-150"></i>
							</a>

							<a href="#">
								<i class="ace-icon fa fa-facebook-square text-primary bigger-150"></i>
							</a>

							<a href="#">
								<i class="ace-icon fa fa-rss-square orange bigger-150"></i>
							</a>
						</span>
						
						------------------------------------------------------------------->
					</div>
				</div>
			</div>

			<a href="#" id="btn-scroll-up" class="btn-scroll-up btn btn-sm btn-inverse">
				<i class="ace-icon fa fa-angle-double-up icon-only bigger-110"></i>
			</a>
		</div><!-- /.main-container -->

		<!-- basic scripts -->

		<!--[if !IE]> -->
		<script src="assets/js/jquery-2.1.4.min.js"></script>

		<!-- <![endif]-->

		<!--[if IE]>
<script src="assets/js/jquery-1.11.3.min.js"></script>
<![endif]-->
		<script type="text/javascript">
			if('ontouchstart' in document.documentElement) document.write("<script src='assets/js/jquery.mobile.custom.min.js'>"+"<"+"/script>");
		</script>
		<script src="assets/js/bootstrap.min.js"></script>

		<!-- page specific plugin scripts -->

		<!--[if lte IE 8]>
		  <script src="assets/js/excanvas.min.js"></script>
		<![endif]-->
		<script src="assets/js/jquery-ui.custom.min.js"></script>
		<script src="assets/js/jquery.ui.touch-punch.min.js"></script>
		<script src="assets/js/jquery.easypiechart.min.js"></script>
		<script src="assets/js/jquery.sparkline.index.min.js"></script>
		<script src="assets/js/jquery.flot.min.js"></script>
		<script src="assets/js/jquery.flot.pie.min.js"></script>
		<script src="assets/js/jquery.flot.resize.min.js"></script>
		<script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script> <!-- //Chart Stats -->	
		<!-- ace scripts -->
		<script src="assets/js/ace-elements.min.js"></script>
		<script src="assets/js/ace.min.js"></script>

		<!-- inline scripts related to this page -->
		<script type="text/javascript">

							
							$(document).ready(function(){
						var token = localStorage.getItem("Token")
						$.post("http://co-project1.eg.mahidol.ac.th/profile/user", 
						{token:token}).then(function(res,status){
							console.log(res)
									$(document).ready(function() {    
									$('#user')[0].innerHTML +=
									res.docs.Username
									
								})
						})
			})

			window.check()

			function check(){
				console.log("check")
				var token = localStorage.getItem("Token")
				var admin = localStorage.getItem("Admin")
				var status = localStorage.getItem("Status")
				if(token){
					console.log("pass")
                    if(admin==0){
                        window.location.href= 'login.html'
                    }else if(admin==1){
						if(status=="Admin"){
							var hiddenInput = document.getElementsByClassName("isHidden") //admin menu
							hiddenInput[0].style.display = "block"  //admin menu
						}else if(status=="Visitor"){

						}
                        
                    }
				}else{
					window.location.href= 'login.html'
                
			    }
            }

			function logout(){
				console.log("logout")
				localStorage.removeItem("Token");
				localStorage.removeItem("Status");
				var admin = localStorage.getItem("Admin")
				if(admin){
					localStorage.removeItem("Admin");
				}
				window.location.href= 'login.html'
			}	
			
		//function : Graph Histrogram
			window.chartHistogram()

			function chartHistogram() {
					$(document).ready(function(){
						
						var amount = []
						var Rule_id = []
						var DataPlot = []
						$.get("http://co-project1.eg.mahidol.ac.th/dashboard/chartHistogram", 
						{}).then(function(res,status){
							// console.log(res)
								res.forEach(element => {
									var a = element.alert1s
									var l = Object.keys(a).length
									amount.push(l)
								});
								res.forEach(element => {
									Rule_id.push(element.Sig_id)
								});
							

							var ColHead = ['Device']
							Rule_id.forEach(element => {
								ColHead.push(element)
							});

							var ColDetail = ['All Device']
							amount.forEach(element => {
								ColDetail.push(element)
							});

							// DataPlot.push()
							DataPlot.push(ColHead)
							DataPlot.push(ColDetail)


							// console.log(DataPlot)
							
							//Chart Stats	
							google.charts.load('current', {'packages':['bar']});
							google.charts.setOnLoadCallback(drawChart);
							function drawChart() {
												var data = google.visualization.arrayToDataTable(DataPlot);

												var options = {
												chart: {
													title: 'All Package',
													subtitle: '',
												},
												bars: 'vertical',
												vAxis: {format: 'decimal'},
												height: 400,
												colors: ['#1b9e77', '#d95f02', '#7570b3']
												};

												var chart = new google.charts.Bar(document.getElementById('chart_div'));

												chart.draw(data, google.charts.Bar.convertOptions(options));

												var btns = document.getElementById('btn-group');

												
							} //drawChart
					}) //then
			}) //ready function
		}

		//function : Graph chartCircle
			window.chartCircle()
			function chartCircle(){
							$(document).ready(function(){
									// console.log(rule)
									$.post("http://co-project1.eg.mahidol.ac.th/dashboard/chartCircle1", 
									{}).then(function(res,status){
										// console.log("1"+res)
										var data = []
										// var data1 = []
										res.forEach(element => {
											var l = Object.keys(element.alert1s).length
											data.push({ label : element.Sig_id , data : l , color: element.Color})
											// console.log(l)
										});
										CircleChart(data,'#piechart-placeholder')
										

									})//then
									$.post("http://co-project1.eg.mahidol.ac.th/dashboard/chartCircle2", 
									{}).then(function(res,status){
										// console.log("2"+res)
										var data2 = []
										// var data1 = []
										res.forEach(element => {
											var l = Object.keys(element.alert2s).length
											data2.push({ label : element.Sig_id , data : l , color: element.Color})
											// console.log(l)
										});
										CircleChart(data2,'#piechart-placeholder2')

									})//then
									$.post("http://co-project1.eg.mahidol.ac.th/dashboard/chartCircle3", 
									{}).then(function(res,status){
										// console.log("3"+res)
										var data3 = []
										// var data1 = []
										res.forEach(element => {
											var l = Object.keys(element.alert3s).length
											data3.push({ label : element.Sig_id , data : l , color: element.Color})
											
										});
										CircleChart(data3,'#piechart-placeholder3')

									})//then
							})//ready
			}
		//recursive : chartCircle
		function CircleChart(data,position){
			// console.log(data)
			
			var placeholder = $(position).css({'width':'90%' , 'min-height':'150px'});
			
			// var data = []

			// data.push({ label : 10000005 , data : 25 , color: '#1b9e77'})

			drawPieChart(placeholder, data);
			placeholder.data('chart', data);
			placeholder.data('draw', drawPieChart);

			function drawPieChart(placeholder, data, position) {
							$.plot(placeholder, data, {
								series: {
									pie: {
										show: true,
										tilt:0.8,
										highlight: {
											opacity: 0.25
										},
										stroke: {
											color: '#fff',
											width: 2
										},
										startAngle: 2
									}
								},
								legend: {
									show: true,
									position: position || "ne", 
									labelBoxBorderColor: null,
									margin:[-30,15]
								},
								grid: {
									hoverable: true,
									clickable: true
								}
							})
						}
			
		}

		//Table Rule
		window.tableRule()
        function tableRule(){
            $(document).ready(function(){
                $.get("http://co-project1.eg.mahidol.ac.th/dashboard/Rule", 
                {}).then(function(res,status){
                        console.log(res)

                        if(status!="success"){
                            console.log("err")
                        }else{
                            var len = res.length
                            console.log("Length = "+len)
							if(len==0){
									$(document).ready(function() {    
									$('table tbody')[0].innerHTML +=
									"Not Found"
								})
							}else{
									res.forEach(element => {
									$(document).ready(function() {    
									$('#dynamic-table tbody')[0].innerHTML +=
									"<tr>" +
											"<td>"+
												// IP Addr
												element.Type+
                                            "</td>"+
                                            "<td>"+
												// Protocal
												element.Protocol+
                                            "</td>"+
                                            "<td>"+
												// Date
												element.Sig_id+
                                            "</td>"+
									"</tr>"
									
								})
								});
									
							}
						}
                })
            })
		}		
			
			
		</script>
	</body>
</html>
